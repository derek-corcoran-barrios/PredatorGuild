{
    "collab_server" : "",
    "contents" : "library(shiny)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(deSolve)\nlibrary(gridExtra)\n\n\nshinyServer(function(input, output) {\n  \n  output$distPlot <- renderPlot({\n    rm(list=ls())     #load packages ggplot2,ggthemes,desolve,gridExtra\n    SIR <- function (times,x,parms) {\n      SL = x[1]\n      IL = x[2]\n      RL = x[3]\n      NL = x[4]\n      SS = x[5]\n      IS = x[6]\n      RS = x[7]\n      NS = x[8]\n      if (IL<1) IL=0\n      if (IS<1) IS=0\n      #BetaL large predator intraspecific transmition Rate\n      with(as.list(c(x,parms)), {\n        dSL <- -(betaL*SL*IL/NL+betaSL*SL*IS/NL) - (b*SL)\n        dIL <- +(betaL*SL*IL/NL+betaSL*SL*IS/NL) - (((gamma + b)/(1-rhoL))*IL) #- gamma*IL - (0.07)*IL   #(b+) 0.015 is the additional mortality due to the infection\n        dRL <- +gamma*IL - b*RL\n        dNL <- +dSL + dIL + dRL\n        dSS <- -(betaS*SS*IS/NS) - ((b+(igp*NL/kl))*SS) #25Aug16 igp decreases as NL decreases; max IGP ~carrying capacity\n        dIS <- +(betaS*SS*IS/NS) - (((gamma + b)/(1-rhoS))*IS) #- gamma*IS - (0.07)*IS   #(add igp) 0.015 is the additional mortality due to the infection\n        dRS <- +gamma*IS - ((b+(igp*NL/kl))*RS)\n        dNS <- +dSS + dIS + dRS\n        out <- c(dSL,dIL,dRL,dNL,dSS,dIS,dRS,dNS)\n        list(out)\n      })\n    }\n    eventfun <- function(t, y, parms){\n      with (as.list(c(y,parms)),{\n        if ((SL+RL) > 2){\n          SL <- SL + (((a)*365)*(1-(NL/kl))*((SL+RL)/2)*round(cos(2%%((t%%365)+2))))#((((a*12)*round(cos(2%%((t%%12)+2))))-((.5*((a*12)-(b*12))*NL/kl)*round(cos(2%%((t%%12)+2)))))*(SL+RL))   # birth pulse\n        }\n        NL <- SL + IL + RL\n        if ((SS+RS) > 1){\n          SS <- SS + (((a)*365)*(1-(NS/ks))*((SS+RS)/2)*round(cos(2%%((t%%365)+2))))#((((a*12)*round(cos(2%%((t%%12)+2))))-((.5*((a*12)-(b*12))*NS/ks)*round(cos(2%%((t%%12)+2)))))*(SS+RS))   # birth pulse\n        }\n        NS <- SS + IS + RS\n        #if (IL<1) IL=0\n        #if (IS<1) IS=0\n        return(c(SL,IL,RL,NL,SS,IS,RS,NS))\n      })\n    }\n    times <- seq(1,20000, by = 1) # daily time step\n    parameters <- c(betaL = input$betaL, betaS = input$betaS, betaSL = input$betaSL, gamma = input$gamma, a= input$a, b = input$b, igp = input$igp, kl = input$kl,ks = input$ks, rhoL = input$rhoL, rhoS = input$rhoS)#beta SL 0.02; igp0011041; igp 0.00543//.000362 to .000452;5Jun16a = .00531435 betas .56 to .14, gamma .3 to .07#a=.0765, b= 0.0543, igp=0.00125, betaSL 0.05\n    init <- c(SL=49,IL=1,RL=0,NL=50,SS=499,IS=1,RS=0,NS=500)\n    out <- as.data.frame(ode(y = init, times = times, func = SIR, parms = parameters, events=list(func=eventfun,time=times)))\n    mydata1 <- data.frame(Period=rep((1:length(out$SL)),4),Population =  c(round(out$SL),round(out$IL),round(out$RL),round(out$NL)),\n                          Indicator=rep(c(\"SusceptibleL\",\"InfectedL\",\"RecoveredL\",\"TotalL\"),each=length(out$SL)))\n    mydata2 <- data.frame(Period=rep((1:length(out$SS)),4),Population =  c(round(out$SS),round(out$IS),round(out$RS),round(out$NS)),#format(round(out$IS,2),nsmall = 2)\n                          Indicator=rep(c(\"SusceptibleS\",\"InfectedS\",\"RecoveredS\",\"TotalS\"),each=length(out$SS)))\n    mydata3 <- data.frame(PopulationS =  round(out$NS),PopulationL =  round(out$NL))\n              \n    \n    p1 = ggplot(mydata1,aes(x=Period,y=Population, group=Indicator))\n    f1 = p1+geom_line(aes(colour = Indicator)) + xlab(\"Time (days)\")+ylab(\"Intraguild Predator \\n population\") + theme_hc(base_size=10)+ theme(legend.position = \"right\",legend.title=element_blank())+ggtitle(\"Disease dynamics \\n\\n Spillover, vhigh intraguild predation \\n\") + theme(plot.title=element_text(face=\"bold\",size=10)) #+ggtitle(\"Population dynamics:\\n Disease cannot be sustained in large predator species alone\")#+theme(plot.title = element_text(size=10, vjust=2))# \"high intraguild predation,with infection spillover\\n\"\n    p2 = ggplot(mydata2,aes(x=Period,y=Population, group=Indicator)) \n    f2 = p2+geom_line(aes(colour = Indicator)) + xlab(\"Time (days)\")+ylab (\"Intraguild Prey \\n population\")  + theme_hc(base_size=10) + theme(legend.position = \"right\",legend.title=element_blank()) #+ ggtitle(\"Disease dynamics in small predator population:\\n No intraguild predation\")\n    f3 = ggplot(mydata3, aes(x = PopulationS, y = PopulationL)) + geom_line()+ theme_hc(base_size=10) + theme(legend.position = \"right\",legend.title=element_blank())\n    grid.arrange(f1,f2,f3,ncol=1)\n  })\n})",
    "created" : 1472581550439.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "913629455",
    "id" : "BACEF257",
    "lastKnownWriteTime" : 1472593350,
    "last_content_update" : 1472593350276,
    "path" : "~/PredatorGuild/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}